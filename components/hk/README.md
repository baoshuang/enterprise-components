## **`hk` component**
`hk` - manage space occupied by artifacts produced by a running system.
Component is located in the `ec/components/hk`.

### Functionality
Artifacts managed via `hk` cover:
- `*.log`, `*.out`, and `*.err`  files generated by working processes
- journals produced by components (e.g.: `tickHF`, `tickLF`)
- files archived by `feedCsv` process
- backups of eod-housekeeping

`hk` process manages artifacts based on file modification date, localization, and file
pattern. Housekeeping process runs configured tasks once a day.

### Configuration
Housekeeping is configured by one configuration variable: `housekeeping`. This variable can be
defined on every level of `system.cfg` file. Lowest-level definition has precedence over higher
ones. Task definition schema (from `system.qsd` file) is defined as an array of actions to perform:

```qsd
housekeeping = <type(ARRAY), model(action(SYMBOL), dir(PATH), age(INT), pattern(SYMBOL), default(())>
```

Following table describes `housekeeping` configuration fields

Configuration field   | Description
----------------------|--------------------------------------------------------------------|
`action`              | Action to perform. Possible actions are compress or delete:<br/>- `compress` - file/directory compression. Already compressed files are ignored<br/>- `delete`   - file/directory deletion
`dir`                 | Directory to operate on. Environamental variables can be referenced here
`age`                 | Age of files (in days) on which the action is performed. See find(1) man page for details on age calculation
`pattern`             | File pattern to use. Metacharacters ('*', '?', and '[]') can be used


List of available actions can be extended by user (see Enterprise Components 3.0 Developers'
Documentation (Hk->hk.q)).

#### system.cfg example
Sample `housekeeping` that will compress all log files older than 30 days, and delete all compressed
files older than 8 days (which gives 38 days before log file is deleted) in the `EC_LOG_PATH`
directory is given below:

```cfg
housekeeping = ((action(compress), dir(${logPath}), age(30), pattern(*.log)), 
                (action(delete),   dir(${logPath}), age(8),  pattern(*.gz)))
```

Placing above definition on the top-level of `system.cfg` file will ensure that actions will be
performed for every process.

In `hk` section of `system.cfg` only housekeeping start time has to be defined – `cfg.startAt`:

```cfg
[[admin.hk]]
  type = q:hk/hk
  port = ${basePort} + 10
  command = "q hk.q"
  cfg.startAt = 02:00:00.000
```

### Startup
start hk
```bash
> yak start core.hk
```

### Actions implementation

Actions (compress or delete) are executed on artifacts that meet dir/age/pattern criteria like in
the `find` command skeleton below:

```bash
$ find -L ${dir} -mtime +${age} –name${pattern} -prune
```

> **Note:**
> 
> Option `-prune` will make the search match directories against given pattern.

